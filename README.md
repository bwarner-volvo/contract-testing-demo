This simple client/server implementation demos how pact-python can be used for a contract test.

## Main components
* `pact_python_demo/user-app.py` -- a simple flask app that has a REST endpoint for `/users/<name>` which returns a JSON representation of a user
* `pact_python_demo/client.py` -- a simple client that gets a user from user-app.
* `tests/test_client.py` -- a set of test cases using pytest and pact-python to test a simple contract between the client and server.
* `broker/` -- contains docker-compose files for a pact broker server

## How to get started?

Step 1: Set up your virtual environment with:

```
$ pip install pipenv
$ pipenv install
```

Step 2: Enter your venv shell with:
```
$ pipenv shell
```

Step 3: Run the test with:
```
(venv) $ pytest
```

You'll see a pact file is generated by the consumer test at `tests/userserviceclient-userservice.json`

Step 4: Fire up your server-side app and verify the provider works as expected:

```
(venv) $ python pact_python_demo/user-app.py
(venv) $ pact-verifier --provider-base-url=http://localhost:5001 \
            --pact-url=tests/userserviceclient-userservice.json \
            --provider-states-setup-url=http://localhost:5001/_pact/provider_states
```

Step 5: start the broker server:
```
$ cd broker
$ docker-compose up
```
It's accessible at http://127.0.0.1 with username 'pactbroker' and password 'pactbroker'

Step 5: To run the test, pushing the generated pact into the broker with version '0.1' of UserServiceClient (Consumer), use:
```
(venv) $ pytest --publish-pact 0.1
```
Step 6: you can validate the provider (UserService) and push the result to the broker by running:
```
(venv) $ python pact_python_demo/user-app.py
(venv) ./verify_pact.sh 0.2
```

Step 7: Log in to the broker and take a look at the matrix. You will see that UserClientService version 0.1 has been verified against UserService version 0.2
